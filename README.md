# effective-giving-AI-persuasion

This repository contains the code supporting the analyses in our paper: "Increasing the effectiveness of charitable giving using human-AI dialogues". Here, you can reproduce all the figures and analyses from the paper. Note, we use the `renv` package to ensure reproducibility ... 

## Paper

**White, J. P., Allen, C., Caviola, L., Costello, T., & Rand, D. G. (2025). Increasing the effectiveness of charitable giving using human-AI dialogues.** *PsyArXiv*. https://osf.io/preprints/psyarxiv/6cyn4_v1

### BibTeX Citation
```bibtex
@misc{white-etal_effective-giving-ai-persuasion,
 title={Increasing the effectiveness of charitable giving using human-AI dialogues},
 url={osf.io/preprints/psyarxiv/6cyn4_v1},
 publisher={PsyArXiv},
 author={White, Joshua P and Allen, Carter and Caviola, Lucius and Costello, Thomas and Rand, David G}
}
```

## Quick Start

### Prerequisites

- **R 4.5.0+** - Download from [r-project.org](https://www.r-project.org/)

### Recommended Software

- **RStudio** - Download from [posit.co](https://posit.co/download/rstudio-desktop/)
- **Quarto** - For automated report generation from `main_report.qmd`
  - Download from [quarto.org](https://quarto.org/docs/get-started/), 
  tested on v1.6.42, and v1.8.21. 
  - Install the R package: `install.packages("quarto")`
- **LaTeX** - For PDF output (optional, HTML output works without it)
  - Windows: [MiKTeX](https://miktex.org/)
  - macOS: [MacTeX](https://www.tug.org/mactex/)
  - Linux: [TeX Live](https://www.tug.org/texlive/)

### Recommended workflow

1. **Clone the repository:**
   ```bash
   git clone https://github.com/WhiteJP/effective-giving-AI-persuasion.git
   cd effective-giving-AI-persuasion
   ```
   
2. **Open the RStudio project:**
   - Double-click `effective-giving-AI-persuasion.Rproj` or
   - Open RStudio and go to File ‚Üí Open Project ‚Üí select the `.Rproj` file

3. **Install dependencies:**
   ```r
   renv::restore()
   ```
   ‚è±Ô∏è This will take 5-10 minutes on an average computer.

4. **Generate the report: reproducing all analyses, figures and tables**
   ```r
   # For PDF output (requires LaTeX)
   quarto::quarto_render("main_report.qmd", output_format = "pdf")
   
   # For HTML output (no LaTeX required, will not render tables)
   quarto::quarto_render("main_report.qmd", output_format = "html")
   ```
   ‚è±Ô∏è This will take 5-10 minutes on an average computer.

### Expected Output

- üìÑ **Main Report**: `output/main_report.pdf` (or `.html`)
- üìä **Figures**: 10 visualizations in `output/figures/`
- ‚è±Ô∏è **Runtime**: 10-20 minutes total (installing packages & running analyses)

### Alternative: Run Scripts Directly

If you prefer not to use Quarto, you can run all analyses with:

```r
source("main.R")
```

This will execute all scripts and generate figures in `output/figures/`. 
Note that you will need to run the scripts in `scripts/analysis` interactively
(in the order shown in `main.R`), not via `source()`, to see analysis output.

## Repository Structure

This repository contains:

- **`scripts/`**: R scripts for data analysis, organized by topic
  - `analysis/`: Main analysis scripts (ATEs, heterogeneity, motivation analysis, etc.)
  - `figures/`: Scripts for generating figures
  - `functions/`: Scripts defining functions used in analysis and plotting. 
  - `tables/`: Scripts for creating tables
  - `nlp/`: Python scripts for natural language processing tasks (not ran here, but included)
- **`data/`**: Data files (after downloading)
- **`output/`**: Generated figures and output files (after running analyses)
- **`main.R`**: Master script that runs all analyses in sequence
- **`main_report.qmd`**: Quarto document for the main report (which runs the same scripts as `main.R`, but automates it and puts it all in the one document)

## Data

The data for this project is hosted on the Open Science Framework (OSF): [https://osf.io/6ya5n](https://osf.io/6ya5n)

**Automatic Download**: You can download the data automatically by running the `scripts/download_data.R` script, which will be run automatically with the `main_report.qmd`, or in `main.R`.

**Main Dataset**: `data_ai-eg-persuasion.csv` (or allready in R in preferred format, `d_all.rds`) is the primary dataset that contains all variables from all analyses already joined together.

**Additional Data Files**:
- **Raw data outputs**: Includes scraped charity information from Candid (formerly GuideStar), API responses from various services (Pro Publica, Charity Navigator), and raw outputs from LLM labeling tasks which were generated by the python scripts in `scripts\nlp` (e.g., factual claim extraction and rating, strategy ratings, motivation coding)
- **Conversation data**: The full text of AI-human dialogues in `conversation_data.csv` cleaned and formatted for analysis


## Technical Details

### System Requirements

**Software Dependencies:**
- R (4.5+)
- (recommended, for report) RStudio, Quarto, Latex distribution

**R Packages** (automatically installed via `renv`):
- Core: dplyr, data.table, purrr, stringr, glue, tidyr, readr, forcats, tibble
- Statistical: mgcv, grf, estimatr, marginaleffects, broom, car
- Visualization: ggplot2, patchwork, ggdist, ggtext, ggExtra, ggsci, jpeg, grid, gridtext, gridExtra
- Web Scraping: rvest, xml2
- File Management: here, fs, osfr
- Tables: gt, kableExtra, modelsummary
- Multiple Testing: qvalue (Bioconductor)
For the full list of direct dependencies see `DESCRIPTION` file.

**Hardware:** Will run on 'normal' desktop or laptop.

**Operating Systems:** Tested on Windows 11, but should run the same on Mac or linux.

